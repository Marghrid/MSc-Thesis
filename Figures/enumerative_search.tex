\begin{figure}[t]
  \centering
  \pgfdeclarelayer{background}   % layer with the synthesizer rectangle
  \pgfsetlayers{background,main} % background behind main
  \begin{tikzpicture}[%
  auto,
  trim left=(verifier), trim right=(verifier)
] %, trim right=(spec)]

  \node (centre) at (0,0) {};

  \node[square] (enumerator) [above=of centre, yshift=-.2cm] {Enumerator};

  \node[square] (verifier) [below=of centre, yshift=.2cm] {Verifier};

  \node[nosquare] (DSL) [above=0.5 of enumerator] {\ac{DSL}};

  \node[nosquare] (spec)    [left=of verifier, xshift=-.8cm] {Specification};

  \node[nosquare] (desired) [right=of verifier, xshift=.8cm] {\textbf{Desired Program}};

  \draw [arrow] (enumerator.240) to node[left=.5mm,align=right,text width=1.5cm] (candidate) {\small Candidate program} (verifier.120);

  \draw [arrow, dashed] (verifier.60) to node[right=.5mm,align=left,text width=1.5cm]  (invalid) {\small Incorrect} (enumerator.300);

  \draw [arrow] (DSL) to (enumerator);

  \draw [arrow] (spec) to (verifier);
  \draw [arrow] (verifier) to node {Correct} (desired);
  
  \begin{pgfonlayer}{background}
    \path let \p1=(DSL.north west),
              \p2=(candidate.west)
    in
      coordinate (topleftcorner) at (\x2, \y1);
      
    \path let \p1=(verifier.south),
              \p2=(invalid.east)
    in
      coordinate (bottomrightcorner) at (\x2, \y1);
      
    \path let \p1=(topleftcorner),
              \p2=(bottomrightcorner)
    in
      coordinate (toprightcorner) at (\x2, \y1);
      
    \draw[enclosing_square] (synth)
      ($(topleftcorner)+(-0.6,0.6)$) rectangle
      ($(bottomrightcorner)+(0.6,-1)$);
    
    \node[gray,nosquare, anchor=north east] (synthtext) at ($(toprightcorner)+(0.5, 0.5)$) {Synthesizer};
  \end{pgfonlayer}

  \end{tikzpicture}

  \caption{Enumerative search}
  \label{fig:enumerative-search}
\end{figure}