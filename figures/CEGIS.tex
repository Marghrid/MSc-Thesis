\begin{figure}[t]
\centering
\pgfdeclarelayer{background}   % layer with the synthesizer rectangle
\pgfsetlayers{background,main} % background behind main
\begin{tikzpicture}[%
  auto,
  trim left=(verifier), trim right=(verifier)
] %, trim right=(spec)]

  \node (centre) at (0,0) {};

  \node[square] (enumerator) [above=of centre, yshift=-.2cm] {Enumerator};

  \node[square] (verifier) [below=of centre, yshift=.2cm, align=left] {Verifier};

  \node[nosquare] (DSL) [above=0.5 of enumerator] {\ac{DSL}};

  \node[nosquare] (spec) [left=1.5 of verifier, align=center, xshift=-.5cm] {Specification};

  \node[nosquare] (valid) [right=1.5 of verifier, xshift=.5cm, align=left] {\textbf{Desired}\\ \textbf{Program}};

  \draw [arrow] (enumerator.240) to node[left=.5mm,align=right, text width=2cm] (candidate) {Candidate\\program} (verifier.120);

  \draw [arrow] (verifier.60) to node[right=.5mm,align=left, text width=2cm]  (counter) {Counter-\\example}  (enumerator.300);

  \draw [arrow] (DSL) to (enumerator);

  \draw [arrow] (spec) to (verifier);
  \draw [arrow] (verifier) to node (unsat) {Correct} (valid);
  
  \begin{pgfonlayer}{background}
    \path let \p1=(DSL.north west),
              \p2=(candidate.west)
    in
      coordinate (topleftcorner) at (\x2, \y1);
      
    \path let \p1=(verifier.south),
              \p2=(counter.east)
    in
      coordinate (bottomrightcorner) at (\x2, \y1);
      
    \path let \p1=(topleftcorner),
              \p2=(bottomrightcorner)
    in
      coordinate (toprightcorner) at (\x2, \y1);
    
    % grey square representing synth's domain
    \draw[enclosing_square] (synth)
      ($(topleftcorner)+(0,0.6)$) rectangle
      ($(bottomrightcorner)+(0,-.8)$);
    
    \node[gray,nosquare, anchor=north east] (synthtext) at ($(toprightcorner)+(0, 0.5)$) {Synthesizer};
  \end{pgfonlayer}

  \end{tikzpicture}


  \caption{\ac{CEGIS}}
  \label{fig:CEGIS}
\end{figure}