\begin{figure}[t]
  \centering
  \pgfdeclarelayer{background}   % layer with the synthesizer rectangle
  \pgfsetlayers{background,main} % background behind main
  \begin{tikzpicture}[%
  auto,
  trim left=(verifier), trim right=(verifier) % makes verifier the centre of the image
]

  \node (centre) at (0,0) {};

  \node[square] (enumerator) [above=of centre, yshift=-.2cm] {Enumerator};

  \node[square] (verifier)   [below=of centre, yshift=.2cm] {Verifier};

  \node[nosquare] (DSL) [above=0.5 of enumerator] {\ac{DSL}};

  \node[nosquare] (spec) [left=2.8 of verifier, align=center] {Specification};

  \node (bottomcentre) [below=1.5 of verifier] {};
  
  \node[square] (distinguisher) [right=.4 of bottomcentre, align=center]
  {Distinguisher};
  
  \node[square] (io_oracle) [left=.4 of bottomcentre]
  {I/O oracle};
  
  \node[nosquare] (valid) [right=1.6 of distinguisher, align=left] {\textbf{Desired}\\ \textbf{Program}};
  
  % EDGES:
  \draw [arrow] (enumerator.240) to node[left=.5mm,align=right, text width=1.9cm] (candidate) {Candidate\\program} (verifier.120);

  \draw [arrow] (verifier.60) to node[right=.5mm,align=left, text width=1.9cm]  (failure) {Counter-\\example }  (enumerator.300);

  \draw [arrow] (DSL) to (enumerator);

  \draw [arrow] (spec) to (verifier);
  \draw [arrow] (distinguisher) to node [align=center, below] (unsat) {Correct\\program} (valid);
  
  \draw [arrow] (verifier) to [bend left]
    node [align=center, right=.1] (p1p2) {2 correct\\programs}
  (distinguisher);
  
  \draw [arrow] (distinguisher) to [bend left]
    node [align=center, below] (dist_input) {Distinguishing\\input}
  (io_oracle);
  
  \draw [arrow] (io_oracle) to [bend left]
    node [align=center, left] (new_io) {New\\example}
  (verifier);
  
  
  
  
  \begin{pgfonlayer}{background}
    \path let \p1=(DSL.north west),
              \p2=(io_oracle.west)
    in
      coordinate (topleftcorner) at (\x2, \y1);
      
    \path let \p1=(dist_input.south),
              \p2=(distinguisher.east)
    in
      coordinate (bottomrightcorner) at (\x2, \y1);
      
    \path let \p1=(topleftcorner),
              \p2=(bottomrightcorner)
    in
      coordinate (toprightcorner) at (\x2, \y1);
    
    % grey square representing synth's domain
    \draw[enclosing_square] (synth)
      ($(topleftcorner)+(-0.8,0.4)$) rectangle
      ($(bottomrightcorner)+(0.8,-.4)$);
    
    \node[gray,nosquare, anchor=north east] (synthtext) at ($(toprightcorner)+(0.5, 0.3)$) {Synthesizer};
  \end{pgfonlayer}

  \end{tikzpicture}

  \caption{\ac{OGIS}}
  \label{fig:OGIS}
\end{figure}