\begin{figure}[t]
  \centering
  \pgfdeclarelayer{background}   % layer with the synthesizer rectangle
  \pgfsetlayers{background,main} % background behind main
  
  
    \begin{tikzpicture}[%
  auto,
  trim left=(decider), trim right=(decider)
] %, trim right=(spec)]

  \node (centre) at (0,0) {};

  \node[square] (enumerator) [above=of centre, yshift=-.2cm] {Enumerator};

  \node[square] (decider)   [below=of centre, yshift=.2cm] {Decider};

  \node[nosquare] (DSL) [above=0.5 of enumerator] {\ac{DSL}};

  
  \node[square] (distinguisher) [below = 1.5 and 1 of decider, align=center]
  {Distinguisher};
  
  \node[square] (user) [below left = .3 and 2.3 of decider]
  {User};
  
  \node[nosquare] (valid) [right=2.7 of distinguisher, align=left] {%
    \textbf{Desired}\\ \textbf{Program}%
  };

  
  \draw [arrow] (enumerator.240) to node[left=.5mm,align=right, text width=1.9cm] (candidate) {Candidate\\program} (decider.120);

  \draw [arrow] (decider.60) to node[right=.5mm, align=left, text width=1.9cm]  (failure) {Reason\\of failure}  (enumerator.300);

  \draw [arrow] (DSL) to (enumerator);

  \draw [arrow] (distinguisher) to [align=center, below] node (unsat) {Correct\\program} (valid);
  
  \draw [arrow] (decider) to node [align=left, right] (p1p2) {2 correct\\programs}
  (distinguisher);
  
  \draw [arrow] (user)    |- node [above, near end, align=center] (io_examples) {Input-output\\examples} (decider);
  
  \draw [arrow] (distinguisher) -| node [below, near start, align=center] (dist_input) { Distinguishing\\input} (user);
  
  %\draw [arrow] (distinguisher.west) to node [align=right, below=.3] (dist_input) {%
  %  distinguishing input%
  %} (user);

  
  \begin{pgfonlayer}{background}
    \path let \p1=(DSL.north west),
              \p2=(enumerator.west)
    in
      coordinate (topleftcorner) at (\x2, \y1);
      
    \path let \p1=(distinguisher.south),
              \p2=(enumerator.east)
    in
      coordinate (bottomrightcorner) at (\x2, \y1);
      
    \path let \p1=(topleftcorner),
              \p2=(bottomrightcorner)
    in
      coordinate (toprightcorner) at (\x2, \y1);
    
    % gre grey square representing synth's domain
    \draw[enclosing_square] (synth)
      ($(topleftcorner)+(-1.5,0.6)$) rectangle
      ($(bottomrightcorner)+(1.5,-.6)$);
    
    \node[gray,nosquare, anchor=north east] (synthtext) at ($(toprightcorner)+(1.1cm, 0.5cm)$) {Synthesizer};
  \end{pgfonlayer}

  \end{tikzpicture}

  \caption{Complete Synthesizer}
  \label{fig:synthesizer}
\end{figure}